import{r as _,C as ne,v as T,J as o,N as t,I as M,q as N,z as n,A as S,Z as x,_ as U,Q as d,O as b,M as se,P as le,L as O,$ as G,a0 as re}from"./group-user-BfSpxGtK.js";import{G as ie}from"./index-BVtcfmMa.js";import{E as ce}from"./jspdf.es.min-DJPMcin4.js";import"./index-Duv_0cVe.js";const ue=["placeholder"],de=n("button",{type:"submit",class:"btn brand-btn-primary",style:{color:"#fff","background-color":"#16AF47"}},"Search",-1),pe={class:"card"},me={class:"card-header"},fe={class:"row"},ve=n("div",{class:"col"},[n("strong",null,"Service Station Mapping")],-1),ge={class:"col text-end"},he={class:"card-body"},ye=n("p",null,"Check this area for viability of a filling station construction?",-1),_e={key:0},be={key:0,class:"text-success"},we={key:1,class:"text-success"},ke={key:1},Ce={key:0,class:"text-danger"},Le={key:1,class:"text-danger"},Ae={key:2},Te={key:3},Me=n("b",null,"Fuel Tank Area:",-1),Ne=n("i",{class:"bi bi-x-square"},null,-1),Se=n("i",{class:"bi bi-floppy"},null,-1),xe=n("i",{class:"bi bi-file-pdf"},null,-1),Pe={class:"mb-3"},Ie=n("label",{for:"areaName",class:"form-label"},"Name of the Area",-1),$e={class:"mb-3"},Re=n("label",{for:"coordinates",class:"form-label"},"Coordinates (Lat, Lng)",-1),Ee={class:"mb-3"},Fe=n("label",{for:"fuelTankArea",class:"form-label"},"Fuel Tank Area Coordinates",-1),qe=n("h4",null,"Search Nearby",-1),We=n("h5",null,"Filling Stations",-1),ze=n("h5",null,"Hospitals",-1),Be=n("h5",null,"Schools",-1),H="http://localhost:3000/",He={__name:"Dashboard",setup(De){const{proxy:V}=re(),W=_(null);let g,C;const F=_(0),q=_(0),z=_(""),$=_(!1),P=_(!1),h=_(!1),L=_(0),A=_(0),w=_([]),R=_(0),E=_(!1),i=_({areaName:"",coordinates:"",fuelTankArea:["","","",""]}),B=_(!1),Y=async()=>{try{return(await G.get(`${H}stations`)).data}catch(a){return console.error("Error fetching gas stations:",a),[]}},j=async()=>{E.value=!1,B.value=!1;const a=await Y(),e=K(i.value.coordinates);if(A.value=e.lng,L.value=e.lat,h.value=!0,w.value=[],a.forEach(s=>{const l=J(s.geog);if(l){const c=Q(e.lat,e.lng,l.lat,l.lng);c<500&&c>0&&(w.value.push(`Too close to ${s.station_name} (${Math.round(c)} meters)`),h.value=!1)}else console.warn("Parsed station coordinates are null for station:",s)}),h.value){const{Place:s,SearchNearbyRankPreference:l}=await google.maps.importLibrary("places"),{LatLng:c}=await google.maps.importLibrary("core"),{spherical:m}=await google.maps.importLibrary("geometry"),f=new c(e.lat,e.lng),v={fields:["displayName","location","businessStatus"],locationRestriction:{center:f,radius:500},includedPrimaryTypes:["hospital","school","secondary_school","primary_school","city_hall"],rankPreference:l.POPULARITY},{places:y}=await s.searchNearby(v);y.forEach(p=>{const k=m.computeDistanceBetween(f,p.location),I=Math.round(k);k<500&&(w.value.push(`Too close to a ${p.displayName} (${I} meters)`),h.value=!1)})}const r=await Z(i.value.fuelTankArea);R.value=r,r<100&&(w.value.push(`Fuel tank area is too small (${r.toFixed(2)} square meters)`),h.value=!1),B.value=!0,h.value?console.log(`The area at ${e.lat}, ${e.lng} is suitable for a gas station.`):w.value.forEach(s=>console.log(`- ${s}`)),P.value=!0},Q=(a,e,r,s)=>{const c=a*Math.PI/180,m=r*Math.PI/180,f=(r-a)*Math.PI/180,v=(s-e)*Math.PI/180,y=Math.sin(f/2)*Math.sin(f/2)+Math.cos(c)*Math.cos(m)*Math.sin(v/2)*Math.sin(v/2);return 6371e3*(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)))},J=a=>{if(typeof a!="string")return null;const e=a.match(/POINT\(([^ ]+) ([^ ]+)\)/);return e?{lat:parseFloat(e[2]),lng:parseFloat(e[1])}:null},K=a=>{const[e,r]=a.split(",").map(s=>parseFloat(s.trim()));return{lat:e,lng:r}},Z=async a=>{await google.maps.importLibrary("core");const{spherical:e}=await google.maps.importLibrary("geometry"),r=a.map(s=>{const[l,c]=s.split(",").map(m=>parseFloat(m.trim()));return new google.maps.LatLng(l,c)});return Math.abs(e.computeArea(r))},X=()=>{const[a,e]=z.value.split(",").map(r=>parseFloat(r.trim()));!isNaN(a)&&!isNaN(e)?(F.value=a,q.value=e,ee(a,e)):console.error("Invalid coordinates")},ee=async(a,e)=>{const r=new google.maps.LatLng(a,e),{AdvancedMarkerElement:s}=await google.maps.importLibrary("marker"),{InfoWindow:l}=await google.maps.importLibrary("maps");g.setCenter(r),C?(C.position=r,C.title="Search Result"):C=new s({position:r,map:g,title:"Search Result"}),new l({content:"<div>Latitude: "+a+"</div><div>Longitude: "+e+"</div>"}).open(g,C)},D=async a=>{const{Place:e,SearchNearbyRankPreference:r}=await google.maps.importLibrary("places"),{AdvancedMarkerElement:s}=await google.maps.importLibrary("marker"),{LatLngBounds:l}=await google.maps.importLibrary("core"),{InfoWindow:c}=await google.maps.importLibrary("maps");let m=new google.maps.LatLng(F.value,q.value);const f={fields:["displayName","location","businessStatus"],locationRestriction:{center:m,radius:1e3},includedPrimaryTypes:[a],maxResultCount:20,rankPreference:r.POPULARITY},{places:v}=await e.searchNearby(f);if(v.length){console.log(v);const y=new l;v.forEach(p=>{const k=new s({map:g,position:p.location,title:p.displayName});k.addListener("click",()=>{new c({headerContent:p.displayName,content:"<div>Status: "+p.businessStatus+"</div>",disableAutoPan:!0,anchor:k}).open(g,k),y.extend(p.location),console.log(p)}),new c({headerContent:p.displayName,content:"<div>Status: "+p.businessStatus+"</div>",disableAutoPan:!0,anchor:k}).open(g,k),y.extend(p.location),console.log(p)}),g.fitBounds(y)}else console.log("No results")},ae=async()=>{const{Place:a,SearchNearbyRankPreference:e}=await google.maps.importLibrary("places"),{LatLng:r}=await google.maps.importLibrary("core"),{spherical:s}=await google.maps.importLibrary("geometry"),l=new r(L.value,A.value),c={fields:["displayName","location","businessStatus"],locationRestriction:{center:l,radius:1e3},includedPrimaryTypes:["gas_station","hospital","school","secondary_school","primary_school","shopping_mall"],rankPreference:e.POPULARITY},{places:m}=await a.searchNearby(c);h.value=!0,w.value=[],m.forEach(f=>{const v=s.computeDistanceBetween(l,f.location),y=Math.round(v);v<1e3&&(w.value.push(`Too close to a ${f.displayName} (${y} meters)`),h.value=!1)}),h.value?console.log(`The area at ${L.value}, ${A.value} is suitable for a gas station.`):(w.value.forEach(f=>console.log(`- ${f}`)),console.log(`The area at ${L.value}, ${A.value} is not suitable for a gas station.`)),P.value=!0,$.value=!1},oe=async()=>{try{const a=await G.post(`${H}saveInspection`,{areaName:i.value.areaName,coordinates:i.value.coordinates,fuelTankArea:i.value.fuelTankArea,fuelTankAreaSquareMeters:R.value,reasons:w.value,isSuitable:h.value});console.log("Inspection saved:",a.data),V.$swal.fire("Success","Inspection saved successfully","success"),P.value=!1,i.value.areaName="",i.value.coordinates="",i.value.fuelTankArea=["","","",""],R.value=0,w.value=[],h.value=!1}catch(a){console.error("Error saving inspection:",a),V.$swal.fire("Error","Failed to save inspection","error")}},te=()=>{const a=new ce,e=10;a.internal.pageSize.getWidth()-2*e,a.setFontSize(16),a.text("Inspection Report",e,e+10),a.setFontSize(12),a.text(`Area Name: ${i.value.areaName}`,e,e+20),a.text(`Coordinates: ${L.value}, ${A.value}`,e,e+30),a.text(`Fuel Tank Area: ${R.value.toFixed(2)} m²`,e,e+40),a.setFontSize(16),a.text("Inspection Results",e,e+50),a.setFontSize(12),h.value?(a.setTextColor(0,128,0),a.text("This area is suitable for a retail station.",e,e+60)):(a.setTextColor(255,0,0),a.text("This area is not suitable for a gas station due to the following reasons:",e,e+60),w.value.forEach((r,s)=>{a.text(`- ${r}`,e,e+70+s*10)})),a.save("inspection_report.pdf")};return ne(()=>{const a=document.createElement("script");a.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADidtsKezQLlIptOGjDqjuOahCWuQWYN8",a.async=!0,a.defer=!0,a.onload=()=>{ie.getCurrentPosition(async e=>{const{AdvancedMarkerElement:r}=await google.maps.importLibrary("marker"),{InfoWindow:s}=await google.maps.importLibrary("maps"),{latitude:l,longitude:c}=e.coords;F.value=l,q.value=c,g=new google.maps.Map(W.value,{center:{lat:l,lng:c},zoom:16,mapId:"6391f83bd22d0376"}),new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,32),C=new r({position:new google.maps.LatLng(l,c),map:g,title:"You are here"}),g.addListener("click",m=>{L.value=m.latLng.lat(),A.value=m.latLng.lng(),$.value=!0}),C.addListener("click",()=>{new s({headerContent:"Current Location",content:`
              <div>
                <h5>You are here</h5>
                <p><strong>Coordinates:</strong> ${l}, ${c}</p>
              </div>
            `}).open(g,C)})},async e=>{const{AdvancedMarkerElement:r}=await google.maps.importLibrary("marker"),{InfoWindow:s}=await google.maps.importLibrary("maps");g=new google.maps.Map(W.value,{center:{lat:-13.9600103,lng:33.7837488},zoom:16,mapId:"6391f83bd22d0376"}),C=new r({position:new google.maps.LatLng(-13.9600103,33.7837488),map:g,title:"MERA Head Office"}),C.addListener("click",()=>{new s({headerContent:"MERA Head Office",content:`
              <div>
                <h5>MERA Head Office</h5>
                <p><strong>Coordinates:</strong> -13.9600103, 33.7837488</p>
              </div>
            `}).open(g,C)})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},document.head.appendChild(a)}),(a,e)=>{const r=M("CInputGroup"),s=M("CCol"),l=M("CButton"),c=M("CModalTitle"),m=M("CModalHeader"),f=M("CModalBody"),v=M("CModalFooter"),y=M("CModal"),p=M("CCardBody"),k=M("CCard"),I=M("CRow");return N(),T("div",null,[o(I,null,{default:t(()=>[o(s,{md:12},{default:t(()=>[n("form",{onSubmit:U(X,["prevent"])},[o(r,{class:"mb-3"},{default:t(()=>[S(n("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=u=>z.value=u),placeholder:`Enter coordinates like: ${F.value}, ${q.value}`,required:""},null,8,ue),[[x,z.value]]),de]),_:1})],32)]),_:1}),o(s,{md:12},{default:t(()=>[n("div",pe,[n("div",me,[n("div",fe,[ve,n("div",ge,[o(l,{color:"primary",size:"sm",onClick:e[1]||(e[1]=()=>{E.value=!0}),class:"brand-btn-secondary"},{default:t(()=>[d("New Inspection")]),_:1})])])]),n("div",he,[n("div",{ref_key:"mapContainer",ref:W,style:{height:"500px"}},null,512)])])]),_:1}),o(y,{visible:$.value,onClose:e[3]||(e[3]=()=>{$.value=!1}),"aria-labelledby":"PopupLabel"},{default:t(()=>[o(m,null,{default:t(()=>[o(c,{id:"PopupLabel"},{default:t(()=>[d("Inspect Area")]),_:1})]),_:1}),o(f,null,{default:t(()=>[n("p",null,"Coordinates: "+b(L.value)+", "+b(A.value),1),ye]),_:1}),o(v,null,{default:t(()=>[o(l,{color:"secondary",onClick:e[2]||(e[2]=()=>{$.value=!1})},{default:t(()=>[d(" Close ")]),_:1}),o(l,{color:"primary",onClick:ae},{default:t(()=>[d(" Inspect ")]),_:1})]),_:1})]),_:1},8,["visible"]),o(y,{visible:P.value,onClose:e[5]||(e[5]=()=>{P.value=!1}),"aria-labelledby":"ReasonsLabel"},{default:t(()=>[o(m,null,{default:t(()=>[o(c,{id:"ReasonsLabel"},{default:t(()=>[d("Inspection Results")]),_:1})]),_:1}),o(f,null,{default:t(()=>[h.value?(N(),T("p",_e,[n("b",null,[d(" The area "),i.value.areaName?(N(),T("span",be,b(i.value.areaName)+"("+b(L.value)+", "+b(A.value)+")",1)):(N(),T("span",we,"at "+b(L.value)+", "+b(A.value),1)),d(" is suitable for a retail station. ")])])):(N(),T("p",ke,[n("b",null,[d(" The area "),i.value.areaName?(N(),T("span",Ce,b(i.value.areaName)+"("+b(L.value)+", "+b(A.value)+")",1)):(N(),T("span",Le,"at "+b(L.value)+", "+b(A.value),1)),d(" is not suitable for a filling station construction due to the following reasons: ")])])),h.value?O("",!0):(N(),T("ul",Ae,[(N(!0),T(se,null,le(w.value,u=>(N(),T("li",{key:u},b(u),1))),128))])),B.value?(N(),T("p",Te,[Me,d(" "+b(R.value.toFixed(2))+" m² ",1)])):O("",!0)]),_:1}),o(v,null,{default:t(()=>[o(l,{color:"secondary",onClick:e[4]||(e[4]=()=>{P.value=!1})},{default:t(()=>[d(" Close "),Ne]),_:1}),o(l,{color:"primary",onClick:oe,class:"brand-btn-primary"},{default:t(()=>[d(" Save "),Se]),_:1}),o(l,{color:"danger",onClick:te,class:"text-white"},{default:t(()=>[d(" Download Report "),xe]),_:1})]),_:1})]),_:1},8,["visible"]),o(y,{visible:E.value,onClose:e[13]||(e[13]=()=>{E.value=!1}),"aria-labelledby":"InspectionModalLabel"},{default:t(()=>[o(m,null,{default:t(()=>[o(c,{id:"InspectionModalLabel"},{default:t(()=>[d("New Inspection")]),_:1})]),_:1}),o(f,null,{default:t(()=>[n("form",{onSubmit:U(j,["prevent"])},[n("div",Pe,[Ie,S(n("input",{type:"text",class:"form-control",id:"areaName","onUpdate:modelValue":e[6]||(e[6]=u=>i.value.areaName=u),required:""},null,512),[[x,i.value.areaName]])]),n("div",$e,[Re,S(n("input",{type:"text",class:"form-control",id:"coordinates","onUpdate:modelValue":e[7]||(e[7]=u=>i.value.coordinates=u),placeholder:"Enter coordinates like: lat, lng",required:""},null,512),[[x,i.value.coordinates]])]),n("div",Ee,[Fe,S(n("input",{type:"text",class:"form-control",id:"fuelTankArea1","onUpdate:modelValue":e[8]||(e[8]=u=>i.value.fuelTankArea[0]=u),placeholder:"Point 1 (lat, lng)",required:""},null,512),[[x,i.value.fuelTankArea[0]]]),S(n("input",{type:"text",class:"form-control mt-2",id:"fuelTankArea2","onUpdate:modelValue":e[9]||(e[9]=u=>i.value.fuelTankArea[1]=u),placeholder:"Point 2 (lat, lng)",required:""},null,512),[[x,i.value.fuelTankArea[1]]]),S(n("input",{type:"text",class:"form-control mt-2",id:"fuelTankArea3","onUpdate:modelValue":e[10]||(e[10]=u=>i.value.fuelTankArea[2]=u),placeholder:"Point 3 (lat, lng)",required:""},null,512),[[x,i.value.fuelTankArea[2]]]),S(n("input",{type:"text",class:"form-control mt-2",id:"fuelTankArea4","onUpdate:modelValue":e[11]||(e[11]=u=>i.value.fuelTankArea[3]=u),placeholder:"Point 4 (lat, lng)",required:""},null,512),[[x,i.value.fuelTankArea[3]]])]),o(l,{type:"submit",color:"primary",class:"brand-btn-primary"},{default:t(()=>[d("Inspect")]),_:1})],32)]),_:1}),o(v,null,{default:t(()=>[o(l,{color:"secondary",onClick:e[12]||(e[12]=()=>{E.value=!1})},{default:t(()=>[d("Close")]),_:1})]),_:1})]),_:1},8,["visible"]),o(s,{md:12},{default:t(()=>[o(I,null,{default:t(()=>[o(s,{md:6,class:"mt-2"},{default:t(()=>[qe,o(I,null,{default:t(()=>[o(s,{sm:4},{default:t(()=>[o(k,null,{default:t(()=>[o(p,null,{default:t(()=>[We,o(l,{color:"primary",onClick:e[14]||(e[14]=u=>D("gas_station")),class:"brand-btn-primary"},{default:t(()=>[d("Search")]),_:1})]),_:1})]),_:1})]),_:1}),o(s,{sm:4},{default:t(()=>[o(k,null,{default:t(()=>[o(p,null,{default:t(()=>[ze,o(l,{color:"primary",onClick:e[15]||(e[15]=u=>D("hospital")),class:"brand-btn-primary"},{default:t(()=>[d("Search")]),_:1})]),_:1})]),_:1})]),_:1}),o(s,{sm:4},{default:t(()=>[o(k,null,{default:t(()=>[o(p,null,{default:t(()=>[Be,o(l,{color:"primary",onClick:e[16]||(e[16]=u=>D("school")),class:"brand-btn-primary"},{default:t(()=>[d("Search")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{He as default};
