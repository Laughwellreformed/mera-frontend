import{G as q}from"./index-BVtcfmMa.js";import{u as B}from"./index-Duv_0cVe.js";import{r as g,C as j,K as V,N as C,$ as T,I as x,q as c,J as k,z as s,Q as _,O as u,v as p,L as w,M as Q,P as Y}from"./group-user-BfSpxGtK.js";import{E as K}from"./jspdf.es.min-DJPMcin4.js";import"./html2canvas.esm-CBrSDip1.js";const U={class:"row align-items-center"},H={class:"col-md-12"},J={key:0,class:"bi bi-patch-check brand-primary-color"},X={key:1,class:"bi bi-stopwatch brand-secondary-color"},Z={key:2,class:"bi bi-x-circle text-danger"},tt={key:3,class:"bi bi-building-fill-gear brand-secondary-color"},et={class:"col-md-12"},st={class:"list-group"},ot={class:"list-group-item"},at={class:"row"},nt={class:"col-md-4"},lt={class:"badge brand-primary-bg"},it={class:"col-md-8"},rt={class:"badge brand-secondary-bg"},ct={class:"list-group-item"},ut=s("strong",null,"Coordinates (Lng, Lat):",-1),dt={class:"list-group-item"},pt=s("strong",null,"Licence number:",-1),_t={class:"list-group-item"},ht=s("strong",null,"District:",-1),mt={class:"list-group-item"},gt=s("strong",null,"Physical Location:",-1),vt={class:"list-group-item"},ft=s("strong",null,"Status:",-1),yt={class:"list-group-item"},bt=s("strong",null,"Operational Agreement:",-1),Ct={class:"list-group-item"},wt=s("strong",null,"Dealer Contacts:",-1),xt={class:"col-md-12 mt-3"},kt={class:"card",id:"results_card"},Nt=s("div",{class:"card-header"},[s("h5",null,"Automated Inspection Results")],-1),$t={key:0,class:"p-3"},Lt={key:0,class:"brand-primary-color"},Mt=s("b",null,"This area is suitable for a retail station.",-1),At=[Mt],Tt={key:1,class:"text-danger"},Pt=s("b",null,"This area is not suitable for a gas station due to the following reasons:",-1),St=[Pt],It={key:2},Ot={key:1,class:"p-3"},Rt=s("p",null,[s("i",null,"Inspecting area...")],-1),Dt=[Rt],P="http://localhost:3000/",Bt={__name:"StationDetails",setup(Et){const S=B(),I=g(S.params.id),N=g(null);let v;const o=g({}),M=g({}),f=g({}),y=g([]),h=g(!1),$=g(!1),O=async()=>{try{const e=await T.get(`${P}station/${I.value}`);o.value=e.data,M.value=e.data.geog}catch(e){console.error("Error fetching stations:",e)}},R=async()=>{try{return(await T.get(`${P}stations`)).data}catch(e){return console.error("Error fetching gas stations:",e),[]}},D=(e,t,n,r)=>{const l=e*Math.PI/180,a=n*Math.PI/180,d=(n-e)*Math.PI/180,m=(r-t)*Math.PI/180,b=Math.sin(d/2)*Math.sin(d/2)+Math.cos(l)*Math.cos(a)*Math.sin(m/2)*Math.sin(m/2);return 6371e3*(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)))},E=e=>{if(typeof e!="string")return null;const t=e.match(/POINT\(([^ ]+) ([^ ]+)\)/);return t?{lat:parseFloat(t[2]),lng:parseFloat(t[1])}:null},F=e=>{if(typeof e!="object"||!e.value)return null;const t=e.value.match(/POINT\(([^ ]+) ([^ ]+)\)/);return t?{lat:parseFloat(t[2]),lng:parseFloat(t[1])}:null},A=async()=>{$.value=!1;const e=await R(),t=f.value;if(h.value=!0,y.value=[],e.forEach(n=>{const r=E(n.geog);if(r){const i=D(t.lat,t.lng,r.lat,r.lng);i<500&&i>0&&(y.value.push(`Too close to ${n.station_name} (${Math.round(i)} meters)`),h.value=!1)}else console.warn("Parsed station coordinates are null for station:",n)}),h.value){const{Place:n,SearchNearbyRankPreference:r}=await google.maps.importLibrary("places"),{LatLng:i}=await google.maps.importLibrary("core"),{spherical:l}=await google.maps.importLibrary("geometry"),a=new i(t.lat,t.lng),d={fields:["displayName","location","businessStatus"],locationRestriction:{center:a,radius:500},includedPrimaryTypes:["hospital","school","secondary_school","primary_school","city_hall"],rankPreference:r.POPULARITY},{places:m}=await n.searchNearby(d);m.forEach(b=>{const L=l.computeDistanceBetween(a,b.location),G=Math.round(L);L<500&&(y.value.push(`Too close to a ${b.displayName} (${G} meters)`),h.value=!1)})}$.value=!0,h.value?console.log(`The area at ${t.lat}, ${t.lng} is suitable for a gas station.`):y.value.forEach(n=>console.log(`- ${n}`))},z=async()=>{const e=new K("p","mm","a4"),t=10,n=e.internal.pageSize.getWidth()-2*t;e.setFontSize(16),e.text("Station Details",t,t+10),e.setFontSize(12),e.text(`Name: ${o.value.station_name}`,t,t+20),e.text(`Type: ${o.value.station_type}`,t,t+30),e.text(`Coordinates: ${f.value.lng}, ${f.value.lat}`,t,t+40),e.text(`Licence Number: ${o.value.licence_number??"N/A"}`,t,t+50),e.text(`District: ${o.value.district??"N/A"}`,t,t+60),e.text(`Physical Location: ${o.value.p_location??"N/A"}`,t,t+70),e.text(`Status: ${o.value.status===1?"Operational":"Not Operational"}`,t,t+80),e.text(`Operational Agreement: ${o.value.op_agreement??"N/A"}`,t,t+90);const r=`Dealer Contacts: ${o.value.dealer_contacts??"N/A"}`;W(r,n,e).forEach((l,a)=>{e.text(l,t,t+100+a*10)}),e.setFontSize(16),e.text("Inspection Results",t,t+120),e.setFontSize(12),h.value?(e.setTextColor(0,128,0),e.text("This area is suitable for a retail station.",t,t+130)):(e.setTextColor(255,0,0),e.text("This area is not suitable for a gas station due to the following reasons:",t,t+130),y.value.forEach((l,a)=>{e.text(`- ${l}`,t,t+140+a*10)})),e.save("inspection_results.pdf")},W=(e,t,n)=>{const r=e.split(" ");let i=[],l="";return r.forEach(a=>{const d=l+a+" ";n.getTextWidth(d)>t?(i.push(l.trim()),l=a+" "):l=d}),i.push(l.trim()),i};return j(async()=>{await O();const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADidtsKezQLlIptOGjDqjuOahCWuQWYN8",e.async=!0,e.defer=!0,e.onload=()=>{q.getCurrentPosition(async t=>{const{AdvancedMarkerElement:n}=await google.maps.importLibrary("marker"),{InfoWindow:r}=await google.maps.importLibrary("maps"),{latitude:i,longitude:l}=t.coords;v=new google.maps.Map(N.value,{center:{lat:i,lng:l},zoom:6,mapId:"6391f83bd22d0376"}),new n({position:new google.maps.LatLng(i,l),map:v,title:"You are here"});const a=F(M);if(a){f.value=a;const d=new n({position:a,map:v,title:o.station_name}),m=new r({content:`
                <div>
                  <h3>${o.value.station_name}</h3>
                  <p><strong>Coordinates:</strong> ${a.lat}, ${a.lng}</p>
                  <p><strong>Type:</strong> ${o.value.station_type}</p>
                  <p><strong>Status:</strong> ${o.value.status===1?"Operational":"Not Operational"}</p>
                </div>
              `});m.open(v,d),d.addListener("click",()=>{m.open(v,d)}),new google.maps.Polyline({path:[{lat:i,lng:l},a],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(v),await A()}},t=>{console.error("Error getting location:",t),v=new google.maps.Map(N.value,{center:{lat:-34.397,lng:150.644},zoom:10,mapId:"6391f83bd22d0376"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},document.head.appendChild(e)}),(e,t)=>{const n=x("CCol"),r=x("CCardbody"),i=x("CCard"),l=x("CRow");return c(),V(l,null,{default:C(()=>[k(n,{md:5},{default:C(()=>[s("div",U,[s("div",H,[s("h3",null,[_(u(o.value.station_name)+" ",1),s("span",null,[o.value.status===1?(c(),p("i",J)):w("",!0),o.value.status===0?(c(),p("i",X)):w("",!0),o.value.status===2?(c(),p("i",Z)):w("",!0),o.value.status===3?(c(),p("i",tt)):w("",!0)])])]),s("div",et,[s("ul",st,[s("li",ot,[s("div",at,[s("div",nt,[s("div",lt,u(o.value.station_type),1)]),s("div",it,[s("div",rt,u(o.value.omc),1)])])]),s("li",ct,[ut,_(" "+u(f.value.lng)+", "+u(f.value.lat),1)]),s("li",dt,[pt,_(" "+u(o.value.licence_number??"N/A"),1)]),s("li",_t,[ht,_(" "+u(o.value.district??"N/A"),1)]),s("li",mt,[gt,_(" "+u(o.value.p_location??"N/A"),1)]),s("li",vt,[ft,_(" "+u(o.value.status===1?"Operational":"Not Operational"),1)]),s("li",yt,[bt,_(" "+u(o.value.op_agreement??"N/A"),1)]),s("li",Ct,[wt,_(" "+u(o.value.dealer_contacts??"N/A"),1)])])]),s("div",xt,[s("div",kt,[Nt,$.value?(c(),p("div",$t,[h.value?(c(),p("p",Lt,At)):(c(),p("p",Tt,St)),h.value?w("",!0):(c(),p("ul",It,[(c(!0),p(Q,null,Y(y.value,a=>(c(),p("li",{key:a},u(a),1))),128))]))])):(c(),p("div",Ot,Dt)),s("div",{class:"card-footer"},[s("button",{onClick:A,class:"btn brand-btn-primary btn-sm"},"Re-inspect Area"),_(" Â  "),s("button",{onClick:z,class:"btn brand-btn-secondary btn-sm"},"Download Results")])])])])]),_:1}),k(n,{md:7},{default:C(()=>[k(i,null,{default:C(()=>[k(r,null,{default:C(()=>[s("div",{ref_key:"mapContainer",ref:N,style:{height:"650px"}},null,512)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Bt as default};
